{% extends 'base.html' %}

{% block title %}Workforce Calendar - Smart HR System{% endblock %}
{% block page_title %}Workforce Calendar{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="page-heading mb-0">
            <i class="fas fa-calendar-alt text-primary"></i> Workforce Calendar
        </h2>
        <p class="text-muted">Manage company events, meetings, and schedules</p>
    </div>
    <div class="btn-group">
        <a href="{% url 'my_calendar' %}" class="btn btn-outline-primary">
            <i class="fas fa-user-calendar"></i> My Calendar
        </a>
        <a href="{% url 'event_create' %}" class="btn btn-primary">
            <i class="fas fa-plus"></i> Add Event
        </a>
    </div>
</div>

<!-- Calendar View -->
<div class="card mb-4">
    <div class="card-header">
        <i class="fas fa-calendar me-2"></i>Calendar - {{ start_date|date:"F Y" }}
    </div>
    <div class="card-body">
        <div id="calendar"></div>
    </div>
</div>

<!-- Upcoming Events -->
<div class="row">
    <div class="col-lg-12">
        <div class="card">
            <div class="card-header">
                <i class="fas fa-list me-2"></i>Upcoming Events
            </div>
            <div class="card-body">
                <div class="list-group">
                    {% for event in events %}
                    <a href="{% url 'event_detail' event.id %}" class="list-group-item list-group-item-action">
                        <div class="d-flex w-100 justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">
                                    {% if event.event_type == 'MEETING' %}
                                        <i class="fas fa-users text-primary"></i>
                                    {% elif event.event_type == 'DEADLINE' %}
                                        <i class="fas fa-exclamation-triangle text-danger"></i>
                                    {% elif event.event_type == 'HOLIDAY' %}
                                        <i class="fas fa-umbrella-beach text-success"></i>
                                    {% elif event.event_type == 'TRAINING' %}
                                        <i class="fas fa-graduation-cap text-info"></i>
                                    {% else %}
                                        <i class="fas fa-calendar text-secondary"></i>
                                    {% endif %}
                                    {{ event.title }}
                                </h6>
                                <p class="mb-1 text-muted small">
                                    <i class="fas fa-clock"></i> {{ event.start_date|date:"M d, Y H:i" }}
                                    {% if event.location %}
                                        | <i class="fas fa-map-marker-alt"></i> {{ event.location }}
                                    {% endif %}
                                </p>
                                {% if event.description %}
                                <p class="mb-0 small">{{ event.description|truncatewords:20 }}</p>
                                {% endif %}
                            </div>
                            <span class="badge bg-{{ event.event_type|lower }}">{{ event.get_event_type_display }}</span>
                        </div>
                    </a>
                    {% empty %}
                    <div class="text-center text-muted py-4">
                        <i class="fas fa-calendar-times fa-3x mb-3 d-block"></i>
                        No upcoming events
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    /* Reduced calendar size for tighter UI */
    #calendar {
        min-height: 420px;
        font-size: 0.92rem; /* slightly smaller text */
    }
    /* Tighter paddings inside calendar cells */
    .fc .fc-daygrid-day-frame, .fc .fc-daygrid-day-top {
        padding: 4px 6px;
    }
    .badge.bg-meeting { background-color: #0d6efd !important; }
    .badge.bg-deadline { background-color: #dc3545 !important; }
    .badge.bg-event { background-color: #6c757d !important; }
    .badge.bg-holiday { background-color: #198754 !important; }
    .badge.bg-training { background-color: #0dcaf0 !important; }
</style>
{% endblock %}

{% block extra_js %}
<!-- FullCalendar integration -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const calendarEl = document.getElementById('calendar');

        const calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            // reduce overall calendar vertical size for a compact display
            contentHeight: 420,
            aspectRatio: 1.2,
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay'
            },
            events: {
                url: '{% url "calendar_events_json" %}',
                method: 'GET'
            },
            eventTimeFormat: { hour: '2-digit', minute: '2-digit', hour12: false },
            eventClick: function(info) {
                // let FullCalendar handle navigation if url exists
                if (info.event.url) {
                    window.location.href = info.event.url;
                    info.jsEvent.preventDefault(); // prevent browser from following the link immediately
                }
            },
            loading: function(isLoading) {
                // optional: show a small loader
            }
        });

        calendar.render();
    });
</script>
{% endblock %}
