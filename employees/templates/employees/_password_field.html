<!-- _password_field.html: reusable password input with realtime validation and strength meter -->
<div class="mb-3">
    <label for="password" class="form-label">Password <span class="text-danger">*</span></label>
    <div class="input-group">
        <input type="password" class="form-control" id="password" name="password" required aria-describedby="passwordHelp">
        <button class="btn btn-outline-secondary" type="button" id="togglePassword" tabindex="-1">Show</button>
    </div>
    <div id="passwordHelp" class="form-text">Minimum 8 characters. Use a mix of letters, numbers and symbols.</div>

    <div class="mt-2">
        <div class="progress" style="height: 8px;">
            <div id="passwordStrengthBar" class="progress-bar" role="progressbar" style="width: 0%;"></div>
        </div>
        <small id="passwordStrengthText" class="form-text"></small>
    </div>

    <ul class="list-unstyled small mt-2" id="passwordRules">
        <li id="rule-length" class="text-muted">• At least 8 characters</li>
        <li id="rule-lower" class="text-muted">• Contains lowercase letter</li>
        <li id="rule-upper" class="text-muted">• Contains uppercase letter</li>
        <li id="rule-number" class="text-muted">• Contains a number</li>
        <li id="rule-symbol" class="text-muted">• Contains a symbol (e.g., !@#$%)</li>
    </ul>

    <script>
    (function(){
        const pw = document.getElementById('password');
        const toggle = document.getElementById('togglePassword');
        const bar = document.getElementById('passwordStrengthBar');
        const text = document.getElementById('passwordStrengthText');

        if (!pw) return;

        toggle.addEventListener('click', function(){
            if (pw.type === 'password') { pw.type = 'text'; toggle.innerText = 'Hide'; }
            else { pw.type = 'password'; toggle.innerText = 'Show'; }
        });

        function scorePassword(s) {
            let score = 0;
            if (!s) return 0;
            // length
            if (s.length >= 8) score += 1;
            // lower
            if (/[a-z]/.test(s)) score += 1;
            // upper
            if (/[A-Z]/.test(s)) score += 1;
            // number
            if (/[0-9]/.test(s)) score += 1;
            // symbol
            if (/[^A-Za-z0-9]/.test(s)) score += 1;
            return score; // 0..5
        }

        function updateUI() {
            const val = pw.value;
            const score = scorePassword(val);
            const pct = (score / 5) * 100;
            bar.style.width = pct + '%';
            bar.className = 'progress-bar';
            if (score <= 2) { bar.classList.add('bg-danger'); text.innerText = 'Weak'; }
            else if (score === 3) { bar.classList.add('bg-warning'); text.innerText = 'Fair'; }
            else if (score >= 4) { bar.classList.add('bg-success'); text.innerText = 'Strong'; }

            // rules
            document.getElementById('rule-length').classList.toggle('text-success', val.length >= 8);
            document.getElementById('rule-lower').classList.toggle('text-success', /[a-z]/.test(val));
            document.getElementById('rule-upper').classList.toggle('text-success', /[A-Z]/.test(val));
            document.getElementById('rule-number').classList.toggle('text-success', /[0-9]/.test(val));
            document.getElementById('rule-symbol').classList.toggle('text-success', /[^A-Za-z0-9]/.test(val));
        }

        pw.addEventListener('input', updateUI);
        // initialize if prefilled
        updateUI();
    })();
    </script>
</div>
